<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="last-modified" content="2025-05-05 21:14:24 UTC">
    <title>SafeNest - Your Refugee Support Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --turquoise: #2A9D8F;
            --deep-turquoise: #264653;
            --sand: #E9C46A;
            --soft-sand: #F4E9CD;
            --gentle-green: #8AB17D;
            --coral: #E76F51;
            --light-turquoise: #83C5BE;
            --cream: #FEFAE0;
            --off-white: #FAF0E6;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            color: #2C3E50;
            background-color: var(--off-white);
            overflow-x: hidden;
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--deep-turquoise);
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 1rem;
        }

        p {
            color: #2C3E50;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        section {
            padding: 4rem 0;
        }

        .service-card, .resource-tile, .testimonial-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .service-card:hover, .resource-tile:hover, .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        a {
            color: var(--turquoise);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--deep-turquoise);
        }

        .cta-button {
            padding: 0.8rem 1.5rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .service-card p, .resource-tile p, .testimonial-card p {
            color: #4A5568;
            font-size: 1rem;
            line-height: 1.7;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--deep-turquoise);
        }

        .testimonial-quote {
            font-style: italic;
            color: #4A5568;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        footer {
            background-color: var(--deep-turquoise);
            color: white;
        }

        footer a {
            color: #E2E8F0;
            transition: color 0.3s ease;
        }

        footer a:hover {
            color: white;
        }

        .chatbot-window {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .chatbot-messages {
            background-color: #F8FAFC;
        }

        .message {
            font-size: 1rem;
            line-height: 1.6;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .bot-message {
            background-color: #EDF2F7;
            color: #2D3748;
        }

        .user-message {
            background-color: var(--turquoise);
            color: white;
        }

        input[type="text"], input[type="email"] {
            padding: 0.8rem 1rem;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            font-size: 1rem;
            color: #2D3748;
            background-color: white;
        }

        input[type="text"]:focus, input[type="email"]:focus {
            outline: none;
            border-color: var(--turquoise);
            box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.1);
        }

        .icon-wrapper {
            background-color: var(--turquoise);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .tag-badge {
            background-color: var(--light-turquoise);
            color: var(--deep-turquoise);
            padding: 0.4rem 0.8rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .scroll-fade {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .handwritten {
            font-family: 'Caveat', cursive;
        }

        .logo-container {
            position: relative;
        }

        .logo {
            position: relative;
            width: 48px;
            height: 48px;
        }

        .logo-base {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 35% 65% 60% 40% / 50% 50% 50% 50%;
            background: var(--turquoise);
            transform: rotate(-5deg);
            transition: all 0.5s ease;
            box-shadow: 0 4px 15px rgba(42, 157, 143, 0.3);
        }

        .logo-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: var(--deep-turquoise);
            border-radius: 30% 70% 100% 0% / 0% 100% 0% 100%;
            transform: rotate(-10deg) translateY(2px);
        }

        .logo-roof {
            position: absolute;
            top: 0;
            left: 10%;
            width: 80%;
            height: 35%;
            background: var(--sand);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
            transform: translateY(-15%);
        }

        .logo:hover .logo-base {
            transform: rotate(5deg) scale(1.05);
        }

        .brand-name {
            font-size: 1.7rem;
            font-weight: 700;
            color: var(--deep-turquoise);
            letter-spacing: -0.5px;
        }

        .brand-name span {
            color: var(--turquoise);
        }

        .tag-badge {
            display: inline-block;
            padding: 0.15rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--light-turquoise);
            color: var(--deep-turquoise);
            transform: translateY(-2px);
        }

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        /* Add these to your existing styles */
.chatbot-mode-toggle {
    display: flex;
    gap: 5px;
}

.chatbot-mode-toggle button {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.chatbot-mode-toggle button:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.chatbot-mode-toggle button.mode-active {
    color: white;
    background-color: rgba(255, 255, 255, 0.2);
}

.chatbot-mic {
    background-color: var(--coral);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-left: 10px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chatbot-mic:hover {
    background-color: var(--deep-turquoise);
}

.chatbot-mic.recording {
    animation: pulse 1.5s infinite;
    background-color: #ff0000;
}

.chatbot-audio-player {
    padding: 0 15px;
    margin-bottom: 10px;
}
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--turquoise);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }

        .user-welcome {
            background: linear-gradient(135deg, var(--soft-sand), var(--cream));
            border-left: 4px solid var(--sand);
        }

        .datetime-display {
            font-family: 'Montserrat', sans-serif;
            color: var(--deep-turquoise);
            font-size: 0.875rem;
        }

        .wave-divider {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 70px;
            fill: var(--off-white);
        }

        .hero-text-box {
            position: relative;
            z-index: 5;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border-left: 5px solid var(--turquoise);
        }

        .hero-text-box p, .hero-text-box span {
            color: var(--deep-turquoise) !important;
        }

        .hero-pattern {
            position: relative;
            background: linear-gradient(135deg, var(--deep-turquoise) 0%, var(--turquoise) 100%);
            overflow: hidden;
        }

        .floating-objects {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .floating-object {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
        }

        .floating-object:nth-child(1) {
            width: 150px;
            height: 150px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-object:nth-child(2) {
            width: 80px;
            height: 80px;
            top: 60%;
            left: 20%;
            animation-delay: 2s;
        }

        .floating-object:nth-child(3) {
            width: 120px;
            height: 120px;
            top: 20%;
            right: 15%;
            animation-delay: 4s;
        }

        .floating-object:nth-child(4) {
            width: 60px;
            height: 60px;
            bottom: 20%;
            right: 25%;
            animation-delay: 6s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) rotate(5deg);
            }
            50% {
                transform: translateY(0) rotate(0deg);
            }
            75% {
                transform: translateY(15px) rotate(-5deg);
            }
        }

        .cta-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            z-index: -1;
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .service-card {
            position: relative;
            transition: all 0.4s ease;
            background: #FAEBD7;
            border-radius: 12px;
            overflow: hidden;
            z-index: 1;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--turquoise);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.4s ease;
            z-index: 5;
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .service-card:hover::before {
            transform: scaleX(1);
            transform-origin: left;
        }

        .service-icon {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.1), rgba(42, 157, 143, 0.2));
            color: var(--turquoise);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .service-card:hover .service-icon {
            transform: scale(1.1) rotate(10deg);
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.2), rgba(42, 157, 143, 0.3));
        }

        .card-action {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            color: var(--turquoise);
            font-weight: 600;
        }

        .card-action::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: var(--turquoise);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        .card-action:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        .resource-tile {
            transition: all 0.3s ease;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .resource-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .resource-icon {
            transition: all 0.3s ease;
        }

        .resource-tile:hover .resource-icon {
            transform: scale(1.15) rotate(5deg);
        }

        .testimonial-card {
            background: #EDC9AF;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }

        .testimonial-card:hover {
            border-bottom-color: var(--turquoise);
            transform: translateY(-5px);
        }

        .testimonial-quote {
            position: relative;
            padding-left: 2rem;
        }

        .testimonial-quote::before {
            content: '"';
            position: absolute;
            top: -1.5rem;
            left: 0;
            font-size: 5rem;
            font-family: 'Caveat', cursive;
            color: rgba(42, 157, 143, 0.2);
            line-height: 1;
        }

        .language-switcher {
            position: relative;
            border: none;
            background: transparent;
            color: var(--deep-turquoise);
            cursor: pointer;
            padding-right: 1.5rem;
        }

        .language-switcher::after {
            content: '▾';
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .language-switcher:focus::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background: var(--turquoise);
            border-radius: 2px;
        }

        .wave-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.1;
            background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='wave' x='0' y='0' width='400' height='200' patternUnits='userSpaceOnUse'%3E%3Cpath d='M0 50 Q 100 0, 200 50 T 400 50 T 600 50 T 800 50 T 1000 50 T 1200 50 V200 H0z' fill='white'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23wave)'/%3E%3C/svg%3E");
        }

        .image-frame {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }

        .image-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.2) 0%, rgba(38, 70, 83, 0.4) 100%);
            z-index: 2;
            transition: all 0.3s ease;
        }

        .image-frame:hover::before {
            background: linear-gradient(135deg, rgba(42, 157, 143, 0.1) 0%, rgba(38, 70, 83, 0.2) 100%);
        }

        .image-frame img {
            transition: transform 0.5s ease;
        }

        .image-frame:hover img {
            transform: scale(1.05);
        }

        .footer-background {
            background: linear-gradient(135deg, var(--deep-turquoise) 0%, #1A323C 100%);
            position: relative;
            overflow: hidden;
        }

        .footer-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* Cursor trailer effect */
        .cursor-trailer {
            position: fixed;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(42, 157, 143, 0.3);
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s, opacity 0.3s;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
        }

        /* Image placeholder styles */
        .image-placeholder {
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e6f2f0, #f0f7f6);
        }

        .placeholder-icon {
            color: rgba(42, 157, 143, 0.3);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--light-turquoise);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--turquoise);
        }

        /* Animated background */
        .animated-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            animation: pulse-grow 8s infinite ease-in-out;
        }

        .bg-circle:nth-child(1) {
            width: 400px;
            height: 400px;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .bg-circle:nth-child(2) {
            width: 300px;
            height: 300px;
            top: 40%;
            right: 10%;
            animation-delay: 2s;
        }

        .bg-circle:nth-child(3) {
            width: 200px;
            height: 200px;
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
        }

        @keyframes pulse-grow {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.5;
            }
        }

        /* Chatbot Styles */
        .chatbot-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--deep-turquoise);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 111, 81, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
            animation: pulse 2s infinite;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
            background-color: var(--deep-turquoise);
        }

        .chatbot-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 430px;
            height: 500px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 1000;
            display: none;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .chatbot-window.active {
            display: flex;
        }

        .chatbot-header {
            background: linear-gradient(135deg, var(--turquoise) 0%, var(--deep-turquoise) 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-title {
            display: flex;
            align-items: center;
        }

        .chatbot-title i {
            margin-right: 10px;
            font-size: 20px;
        }

        .chatbot-close {
            cursor: pointer;
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .chatbot-close:hover {
            transform: rotate(90deg);
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 15px;
            line-height: 1.5;
            position: relative;
            font-size: 14px;
        }

        .bot-message {
            background-color: #f1f1f1;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background-color: var(--turquoise);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .chatbot-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 14px;
        }

        .chatbot-input input:focus {
            border-color: var(--turquoise);
        }

        .chatbot-send {
            background-color: var(--turquoise);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chatbot-send:hover {
            background-color: var(--deep-turquoise);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f1f1f1;
            border-radius: 15px;
            max-width: 70px;
            margin-bottom: 10px;
            align-self: flex-start;
            display: none;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 3px;
            animation: typing-dot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-dot {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 111, 81, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(231, 111, 81, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(231, 111, 81, 0);
            }
        }
    </style>
</head>
<body>
    <!-- Cursor Trailer -->
    <div class="cursor-trailer"></div>

    <header class="bg-white shadow-md sticky top-0 z-50 transition-shadow duration-300">
        <div class="container mx-auto px-4">
            

            <nav class="py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="logo-container">
                        <div class="logo">
                            <div class="logo-base"></div>
                            <div class="logo-wave"></div>
                            <div class="logo-roof"></div>
                        </div>
                    </div>
                    <div class="brand-name">Safe<span>Nest</span></div>
                </div>
                <div class="flex space-x-8">
                    <a href="/" class="nav-link active font-medium text-turquoise hover:text-turquoise transition-colors py-2">Home</a>
                    <a href="/translation" class="nav-link font-medium text-gray-600 hover:text-turquoise transition-colors py-2">Translation</a>
                    <a href="/assistant" class="nav-link font-medium text-gray-600 hover:text-turquoise transition-colors py-2">Assistant</a>
                    <a href="/document_processing" class="nav-link font-medium text-gray-600 hover:text-turquoise transition-colors py-2">Documents</a>
                    <a href="/resource_map" class="nav-link font-medium text-gray-600 hover:text-turquoise transition-colors py-2">Ressources Map</a>

                </div>
                <div class="flex items-center space-x-4">
                    <select class="language-switcher font-medium text-sm focus:outline-none">
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                        <option value="ar">العربية</option>
                        <option value="es">Español</option>
                    </select>
                    
                </div>
            </nav>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero-pattern text-white py-24 md:py-32 relative overflow-hidden">
            <!-- Animated Background -->
            <div class="animated-bg">
                <div class="bg-circle"></div>
                <div class="bg-circle"></div>
                <div class="bg-circle"></div>
            </div>
            
            <!-- Floating Objects -->
            <div class="floating-objects">
                <div class="floating-object"></div>
                <div class="floating-object"></div>
                <div class="floating-object"></div>
                <div class="floating-object"></div>
            </div>
            
            <div class="container mx-auto px-4 md:px-12 relative z-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="order-2 md:order-1 text-center md:text-left">
                        <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
                            Find Your <span class="handwritten text-sand">Safe Haven</span>
                        </h1>
                        <div class="hero-text-box p-6 mb-8">
                            <p class="text-lg md:text-xl font-light text-deep-turquoise">
                                A community platform providing support, resources, and guidance for refugees starting a new chapter in life.
                            </p>
                            
                        </div>
                        <div class="flex flex-wrap justify-center md:justify-start gap-4">
                            <a href="/translation" class="cta-button group bg-turquoise hover:bg-deep-turquoise text-white font-medium rounded-lg px-8 py-4 shadow-lg transition-all transform hover:scale-105 hover:rotate-1">
                                <i class="fas fa-language mr-2 group-hover:animate-bounce"></i>Translation Services
                            </a>
                            <a href="/assistant" class="cta-button group bg-sand hover:bg-coral text-deep-turquoise hover:text-white font-medium rounded-lg px-8 py-4 shadow-lg transition-all transform hover:scale-105 hover:-rotate-1">
                                <i class="fas fa-comments mr-2 group-hover:animate-bounce"></i>Get Support
                            </a>
                        </div>
                    </div>
                    <div class="order-1 md:order-2 flex justify-center items-center">
                        <div class="relative w-full max-w-md">
                            <div class="absolute inset-0 bg-gradient-to-r from-sand to-coral rounded-full blur-3xl opacity-20 animate-pulse"></div>
                            <div class="image-frame shadow-2xl w-full aspect-square rounded-2xl overflow-hidden">
                                <div class="image-placeholder w-full h-full">
                                    <img src="/static/images/politik.jpg" alt="Diverse group of people supporting each other" class="w-full h-full object-cover" />
                                </div>
                                <div class="absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-deep-turquoise to-transparent">
                                    <p class="text-white text-center handwritten text-xl">"Every journey begins with hope"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Wave Divider -->
            <svg class="wave-divider" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 70">
                <path d="M0,35L48,40.8C96,47,192,58,288,56.7C384,56,480,42,576,36.2C672,30,768,32,864,41.8C960,51,1056,67,1152,65.3C1248,63,1344,44,1392,34.2L1440,25L1440,70L1392,70C1344,70,1248,70,1152,70C1056,70,960,70,864,70C768,70,672,70,576,70C480,70,384,70,288,70C192,70,96,70,48,70L0,70Z"></path>
            </svg>
        </section>

        <!-- Services Section -->
        <section class="py-20 bg-gray-50 relative">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="section-title text-3xl md:text-4xl font-bold text-deep-turquoise mb-4">How We Help</h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">Comprehensive support services designed to help you navigate your new beginning with confidence and dignity.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Translation Card -->
                    <div class="service-card scroll-fade shadow-lg bg-white">
                        <div class="p-8">
                            <div class="service-icon mb-6">
                                <i class="fas fa-language"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-3 text-deep-turquoise">Translation Service</h3>
                            <p class="text-gray-600 mb-6 text-base leading-relaxed">Break language barriers with our real-time translation services in over 30 languages. Connect, understand, and express yourself confidently.</p>
                            <a href="/translation" class="card-action inline-flex items-center">
                                Start Translating
                                <i class="fas fa-arrow-right ml-2 transition-transform duration-300 transform group-hover:translate-x-1"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Assistant Card -->
                    <div class="service-card scroll-fade shadow-lg bg-white" style="transition-delay: 0.2s;">
                        <div class="p-8">
                            <div class="service-icon mb-6">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-3 text-deep-turquoise">Support Assistant</h3>
                            <p class="text-gray-600 mb-6 text-base leading-relaxed">Get instant answers to your questions about housing, healthcare, education, employment, and legal matters from our AI-powered assistant.</p>
                            <a href="/assistant" class="card-action inline-flex items-center">
                                Ask Questions
                                <i class="fas fa-arrow-right ml-2 transition-transform duration-300 transform group-hover:translate-x-1"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Document Processing Card -->
                    <div class="service-card scroll-fade shadow-lg bg-white" style="transition-delay: 0.4s;">
                        <div class="p-8">
                            <div class="service-icon mb-6">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-3 text-deep-turquoise">Document Processing</h3>
                            <p class="text-gray-600 mb-6 text-base leading-relaxed">Simplify paperwork with our document processing service. Scan, translate, fill forms, and get guidance on required documentation.</p>
                            <a href="/document_processing" class="card-action inline-flex items-center">
                                Process Documents
                                <i class="fas fa-arrow-right ml-2 transition-transform duration-300 transform group-hover:translate-x-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Resources Section -->
        <section class="py-20 bg-orange-50 relative">
            <div class="wave-bg"></div>
            <div class="container mx-auto px-4 relative z-10">
                <div class="text-center mb-16">
                    <h2 class="section-title text-3xl md:text-4xl font-bold text-deep-turquoise mb-4">Essential Resources</h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">Access vital information and resources to help you establish your new life with confidence.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Resource Tile 1 -->
                    <div class="resource-tile scroll-fade shadow p-6 flex flex-col items-center text-center">
                        <div class="resource-icon bg-soft-sand p-4 rounded-full mb-4 w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-home text-2xl text-coral"></i>
                        </div>
                        <h3 class="text-lg font-bold mb-2 text-deep-turquoise">Housing Support</h3>
                        <p class="text-gray-600 text-sm mb-4">Find temporary shelters, affordable housing options, and rental assistance programs.</p>
                        <a href="/resources/housing" class="mt-auto text-turquoise font-medium hover:text-deep-turquoise transition-colors flex items-center">
                            <span>Learn More</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </a>
                    </div>
                    
                    <!-- Resource Tile 2 -->
                    <div class="resource-tile scroll-fade shadow p-6 flex flex-col items-center text-center" style="transition-delay: 0.1s;">
                        <div class="resource-icon bg-soft-sand p-4 rounded-full mb-4 w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-heartbeat text-2xl text-coral"></i>
                        </div>
                        <h3 class="text-lg font-bold mb-2 text-deep-turquoise">Healthcare Access</h3>
                        <p class="text-gray-600 text-sm mb-4">Connect with medical services, mental health support, and healthcare providers.</p>
                        <a href="/resources/healthcare" class="mt-auto text-turquoise font-medium hover:text-deep-turquoise transition-colors flex items-center">
                            <span>Learn More</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </a>
                    </div>
                    
                    <!-- Resource Tile 3 -->
                    <div class="resource-tile scroll-fade shadow p-6 flex flex-col items-center text-center" style="transition-delay: 0.2s;">
                        <div class="resource-icon bg-soft-sand p-4 rounded-full mb-4 w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-graduation-cap text-2xl text-coral"></i>
                        </div>
                        <h3 class="text-lg font-bold mb-2 text-deep-turquoise">Education</h3>
                        <p class="text-gray-600 text-sm mb-4">Access educational resources, language classes, and skill development programs.</p>
                        <a href="/resources/education" class="mt-auto text-turquoise font-medium hover:text-deep-turquoise transition-colors flex items-center">
                            <span>Learn More</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </a>
                    </div>
                    
                    <!-- Resource Tile 4 -->
                    <div class="resource-tile scroll-fade shadow p-6 flex flex-col items-center text-center" style="transition-delay: 0.3s;">
                        <div class="resource-icon bg-soft-sand p-4 rounded-full mb-4 w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-briefcase text-2xl text-coral"></i>
                        </div>
                        <h3 class="text-lg font-bold mb-2 text-deep-turquoise">Employment</h3>
                        <p class="text-gray-600 text-sm mb-4">Find job opportunities, career guidance, and professional development resources.</p>
                        <a href="/resources/employment" class="mt-auto text-turquoise font-medium hover:text-deep-turquoise transition-colors flex items-center">
                            <span>Learn More</span>
                            <i class="fas fa-chevron-right ml-1 text-xs"></i>
                        </a>
                    </div>
                </div>
                
                <div class="mt-12 text-center">
                    <a href="/resources" class="inline-block bg-sand hover:bg-coral text-deep-turquoise hover:text-white font-medium rounded-lg px-6 py-3 transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-lg">
                        View All Resources <i class="fas fa-external-link-alt ml-2"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="py-20 bg-teal-50 relative">
            <div class="container mx-auto px-4">
                <div class="text-center mb-16">
                    <h2 class="section-title text-3xl md:text-4xl font-bold text-deep-turquoise mb-4">Success Stories</h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">Hear from people who have rebuilt their lives with the help of our platform.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Testimonial 1 -->
                    <div class="testimonial-card scroll-fade shadow-lg p-6 bg-white">
                        <div class="flex items-center mb-4">
                            <div class="w-14 h-14 rounded-full overflow-hidden mr-4">
                                <img src="/static/images/testimonial1.png" alt="Sara's profile" class="w-full h-full object-cover" />
                            </div>
                            <div>
                                <h3 class="font-bold text-deep-turquoise">Sara T.</h3>
                                <p class="text-gray-500 text-sm">From Syria, now in Germany</p>
                            </div>
                        </div>
                        <div class="testimonial-quote mb-4">
                            <p class="text-gray-600 italic">"The translation service made it possible for me to communicate with my child's teacher. I'm grateful for the support that helped us settle into our new home."</p>
                        </div>
                        <div class="flex text-yellow-400">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    
                    <!-- Testimonial 2 -->
                    <div class="testimonial-card scroll-fade shadow-lg p-6 bg-white" style="transition-delay: 0.2s;">
                        <div class="flex items-center mb-4">
                            <div class="w-14 h-14 rounded-full overflow-hidden mr-4">
                                <img src="/static/images/testimonial2.png" alt="Ahmed's profile" class="w-full h-full object-cover" />
                            </div>
                            <div>
                                <h3 class="font-bold text-deep-turquoise">Ahmed K.</h3>
                                <p class="text-gray-500 text-sm">From Canada, now in UK</p>
                            </div>
                        </div>
                        <div class="testimonial-quote mb-4">
                            <p class="text-gray-600 italic">"Thanks to the document processing help, I was able to get my medical credentials recognized. Now I'm working as a nurse again and helping others."</p>
                        </div>
                        <div class="flex text-yellow-400">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                    </div>
                    
                    <!-- Testimonial 3 -->
                    <div class="testimonial-card scroll-fade shadow-lg p-6 bg-white" style="transition-delay: 0.4s;">
                        <div class="flex items-center mb-4">
                            <div class="w-14 h-14 rounded-full overflow-hidden mr-4">
                                <img src="/static/images/testimonial3.png" alt="Elena's profile" class="w-full h-full object-cover" />
                            </div>
                            <div>
                                <h3 class="font-bold text-deep-turquoise">Elena M.</h3>
                                <p class="text-gray-500 text-sm">From Ukraine, now in Poland</p>
                            </div>
                        </div>
                        <div class="testimonial-quote mb-4">
                            <p class="text-gray-600 italic">"The community has become like family to me. Through the mentorship program, I found guidance that helped me start my own small business."</p>
                        </div>
                        <div class="flex text-yellow-400">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                </div>
                
                <div class="mt-12 text-center">
                    <a href="/testimonials" class="text-turquoise hover:text-deep-turquoise font-medium transition-colors inline-flex items-center">
                        Read More Success Stories 
                        <i class="fas fa-long-arrow-alt-right ml-2"></i>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer-background text-white py-12 relative">
        <div class="container mx-auto px-4 relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="md:col-span-1">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="logo-container">
                            <div class="logo">
                                <div class="logo-base"></div>
                                <div class="logo-wave"></div>
                                <div class="logo-roof"></div>
                            </div>
                        </div>
                        <div class="text-xl font-bold">Safe<span class="text-light-turquoise">Nest</span></div>
                    </div>
                    <p class="text-gray-300 mb-6">Supporting refugees on their journey to build new lives with dignity and hope.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-light-turquoise hover:text-white transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="text-light-turquoise hover:text-white transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-light-turquoise hover:text-white transition-colors">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="text-light-turquoise hover:text-white transition-colors">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
                
                <div class="md:col-span-1">
                    <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/" class="text-gray-300 hover:text-light-turquoise transition-colors">Home</a></li>
                        <li><a href="/about" class="text-gray-300 hover:text-light-turquoise transition-colors">About Us</a></li>
                        <li><a href="/services" class="text-gray-300 hover:text-light-turquoise transition-colors">Services</a></li>
                        <li><a href="/resources" class="text-gray-300 hover:text-light-turquoise transition-colors">Resources</a></li>
                        <li><a href="/contact" class="text-gray-300 hover:text-light-turquoise transition-colors">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="md:col-span-1">
                    <h3 class="text-lg font-bold mb-4">Services</h3>
                    <ul class="space-y-2">
                        <li><a href="/translation" class="text-gray-300 hover:text-light-turquoise transition-colors">Translation</a></li>
                        <li><a href="/assistant" class="text-gray-300 hover:text-light-turquoise transition-colors">AI Assistant</a></li>
                        <li><a href="/document_processing" class="text-gray-300 hover:text-light-turquoise transition-colors">Document Processing</a></li>
                        <li><a href="/legal_help" class="text-gray-300 hover:text-light-turquoise transition-colors">Legal Support</a></li>
                        <li><a href="/education" class="text-gray-300 hover:text-light-turquoise transition-colors">Education Resources</a></li>
                        <li><a href="/employment" class="text-gray-300 hover:text-light-turquoise transition-colors">Employment Help</a></li>
                    </ul>
                </div>
                
                <div class="md:col-span-1">
                    <h3 class="text-lg font-bold mb-4">Contact Info</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt text-light-turquoise mt-1 mr-3"></i>
                            <span>123 Global Avenue, New York, NY 10001, USA</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone-alt text-light-turquoise mr-3"></i>
                            <span>+1 (800) 123-4567</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-envelope text-light-turquoise mr-3"></i>
                            <span>support@safenest.org</span>
                        </li>
                    </ul>
                    <div class="mt-6">
                        <h4 class="font-bold mb-2">Subscribe to Newsletter</h4>
                        <div class="flex">
                            <input type="email" placeholder="Your email" class="px-4 py-2 rounded-l-lg focus:outline-none text-gray-700 w-full" />
                            <button class="bg-turquoise hover:bg-deep-turquoise text-white px-4 py-2 rounded-r-lg transition-colors">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-12 pt-6 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm mb-4 md:mb-0">&copy; 2025 SafeNest. All rights reserved.</p>
                <div class="flex space-x-6">
                    <a href="/privacy" class="text-gray-400 hover:text-light-turquoise text-sm transition-colors">Privacy Policy</a>
                    <a href="/terms" class="text-gray-400 hover:text-light-turquoise text-sm transition-colors">Terms of Service</a>
                    <a href="/sitemap" class="text-gray-400 hover:text-light-turquoise text-sm transition-colors">Sitemap</a>
                </div>
                <div class="mt-4 md:mt-0 text-gray-400 text-sm">
                    <span>Made with ❤️ by</span>
                    <a href="https://github.com/Maryem-Jlassi" class="text-light-turquoise hover:text-white transition-colors"> Maryem Jlassi</a>
                </div>
            </div>
        </div>
    </footer>

<!-- Chatbot Button -->
<div class="chatbot-button" id="chatbotButton">
    <i class="fas fa-robot"></i>
</div>

<!-- Chatbot Window -->
<div class="chatbot-window" id="chatbotWindow">
    <div class="chatbot-header">
        <div class="chatbot-title">
            <i class="fas fa-robot"></i>
            <h3>SafeNest Assistant</h3>
        </div>
        <div class="chatbot-mode-toggle">
            <button id="textModeBtn" class="mode-active"><i class="fas fa-keyboard"></i></button>
            <button id="voiceModeBtn"><i class="fas fa-microphone"></i></button>
        </div>
        <div class="chatbot-close" id="chatbotClose">
            <i class="fas fa-times"></i>
        </div>
    </div>
    <div class="chatbot-messages" id="chatbotMessages">
        <div class="message bot-message">
            Hello! I'm your SafeNest Assistant. How can I help you today with resources, translation, or document processing?
        </div>
        <!-- The typing indicator is now dynamically inserted in the JS -->
    </div>
    <div class="chatbot-audio-player" id="chatbotAudioPlayer" style="display: none;">
        <audio id="responseAudio" controls style="width: 100%; display: none;"></audio>
    </div>
    <div class="chatbot-input">
        <input type="text" id="userInput" placeholder="Type your question here..." />
        <button class="chatbot-send" id="sendButton">
            <i class="fas fa-paper-plane"></i>
        </button>
        <button class="chatbot-mic" id="micButton" style="display: none;">
            <i class="fas fa-microphone"></i>
        </button>
    </div>
</div>

<style>
    /* Styles spécifiques pour l'indicateur de chargement */
    .typing-indicator {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background-color: #f1f1f1;
        border-radius: 15px;
        max-width: 70px;
        margin-bottom: 10px;
        align-self: flex-start;
    }
    
    .typing-dot {
        width: 8px;
        height: 8px;
        background-color: #888;
        border-radius: 50%;
        margin: 0 3px;
        animation: typing-dot 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) {
        animation-delay: 0s;
    }
    
    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing-dot {
        0%, 60%, 100% {
            transform: translateY(0);
        }
        30% {
            transform: translateY(-5px);
        }
    }
    
    /* Amélioration de l'affichage des messages */
    .chatbot-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    
    .message {
        max-width: 70%;
        padding: 10px 15px;
        margin-bottom: 10px;
        border-radius: 15px;
        line-height: 1.5;
        position: relative;
        font-size: 14px;
        word-wrap: break-word;
    }
    
    .bot-message {
        background-color: #f1f1f1;
        color: #333;
        align-self: flex-start;
        border-bottom-left-radius: 5px;
    }
    
    .user-message {
        background-color: var(--turquoise, #2A9D8F);
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 5px;
    }
    </style>
    <script>
        // Chatbot functionality
document.addEventListener('DOMContentLoaded', function() {
    const chatbotButton = document.getElementById('chatbotButton');
    const chatbotWindow = document.getElementById('chatbotWindow');
    const chatbotClose = document.getElementById('chatbotClose');
    const chatbotMessages = document.getElementById('chatbotMessages');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const textModeBtn = document.getElementById('textModeBtn');
    const voiceModeBtn = document.getElementById('voiceModeBtn');
    const micButton = document.getElementById('micButton');
    const sendTextButton = document.getElementById('sendButton');
    const audioPlayer = document.getElementById('responseAudio');
    const chatbotAudioPlayer = document.getElementById('chatbotAudioPlayer');
    
    let isRecording = false;
    let mediaRecorder = null;
    let audioChunks = [];
    let currentMode = 'text'; // Default mode is text
    let currentLanguage = 'en-GB'; // Default language
    let typingIndicator = null; // Reference to the typing indicator element
    
    // Try to get preferred language from page
    try {
        const languageSwitcher = document.querySelector('.language-switcher');
        if (languageSwitcher) {
            currentLanguage = languageSwitcher.value;
        }
    } catch (error) {
        console.log('Could not detect language preference, using default');
    }
    
    // Toggle chatbot window
    chatbotButton.addEventListener('click', () => {
        chatbotWindow.classList.toggle('active');
        if (chatbotWindow.classList.contains('active')) {
            userInput.focus();
        }
    });
    
    chatbotClose.addEventListener('click', () => {
        chatbotWindow.classList.remove('active');
    });
    
    // Switch between text and voice modes
    textModeBtn.addEventListener('click', () => {
        if (currentMode !== 'text') {
            currentMode = 'text';
            textModeBtn.classList.add('mode-active');
            voiceModeBtn.classList.remove('mode-active');
            userInput.style.display = 'block';
            sendTextButton.style.display = 'flex';
            micButton.style.display = 'none';
            stopRecording();
        }
    });
    
    voiceModeBtn.addEventListener('click', () => {
        if (currentMode !== 'voice') {
            currentMode = 'voice';
            voiceModeBtn.classList.add('mode-active');
            textModeBtn.classList.remove('mode-active');
            userInput.style.display = 'none';
            sendTextButton.style.display = 'none';
            micButton.style.display = 'flex';
        }
    });
    
    // Function to add a message to the chat
    function addMessage(text, isUser = false) {
        // Remove existing typing indicator if any
        if (typingIndicator) {
            typingIndicator.remove();
            typingIndicator = null;
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message');
        messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
        messageDiv.textContent = text;
        
        chatbotMessages.appendChild(messageDiv);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        
        return messageDiv; // Return the message element for reference
    }
    
    // Function to create and show typing indicator after a specific message
    function showTypingIndicator(afterElement = null) {
        // If no element specified, append to the chat container
        const container = afterElement || chatbotMessages;
        
        // Create typing indicator
        typingIndicator = document.createElement('div');
        typingIndicator.className = 'typing-indicator';
        
        // Create typing dots
        for (let i = 0; i < 3; i++) {
            const dot = document.createElement('div');
            dot.className = 'typing-dot';
            typingIndicator.appendChild(dot);
        }
        
        // Add to container
        container.appendChild(typingIndicator);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        
        // Pour déboguer - afficher un message console
        console.log("Indicateur de frappe affiché");
    }
    
    // Function to hide typing indicator
    function hideTypingIndicator() {
        if (typingIndicator) {
            typingIndicator.remove();
            typingIndicator = null;
            console.log("Indicateur de frappe masqué");
        }
    }
    
    // Function to process user message and get AI response
    async function processMessage(userMessage) {
        // Add user message to chat and get reference to the message element
        const userMessageElement = addMessage(userMessage, true);
        
        // Show typing indicator right after the user message
        showTypingIndicator(chatbotMessages);
        
        try {
            // Simuler un délai pour tester l'indicateur (à supprimer en production)
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Call the backend API
            const response = await fetch('/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: userMessage }),
            });
            
            const data = await response.json();
            
            if (response.ok) {
                // Hide typing indicator and add bot response
                hideTypingIndicator();
                addMessage(data.answer);
                
                // Generate speech if in voice mode
                if (currentMode === 'voice') {
                    generateSpeech(data.answer);
                }
            } else {
                throw new Error(data.error || 'Failed to get response');
            }
        } catch (error) {
            console.error("Error processing message:", error);
            hideTypingIndicator();
            addMessage("I'm sorry, I'm having trouble connecting right now. Please try again later.");
        }
    }
    
    // Function to generate speech from text
    async function generateSpeech(text) {
        try {
            const response = await fetch('/text_to_speech', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    text: text,
                    language: currentLanguage
                }),
            });
            
            const data = await response.json();
            
            if (response.ok && data.audio_url) {
                audioPlayer.src = data.audio_url;
                chatbotAudioPlayer.style.display = 'block';
                audioPlayer.style.display = 'block';
                audioPlayer.play();
            } else {
                console.error("Failed to generate speech:", data.error);
            }
        } catch (error) {
            console.error("Error generating speech:", error);
        }
    }
    
    // Function to handle voice input
    micButton.addEventListener('click', () => {
        if (!isRecording) {
            startRecording();
        } else {
            stopRecording();
        }
    });
    
    // Start recording audio
    function startRecording() {
        isRecording = true;
        audioChunks = [];
        micButton.classList.add('recording');
        
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.addEventListener('dataavailable', event => {
                    audioChunks.push(event.data);
                });
                
                mediaRecorder.addEventListener('stop', () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    processAudio(audioBlob);
                });
                
                mediaRecorder.start();
                
                // Auto-stop after 10 seconds
                setTimeout(() => {
                    if (isRecording) {
                        stopRecording();
                    }
                }, 10000);
            })
            .catch(error => {
                console.error("Error accessing microphone:", error);
                addMessage("I couldn't access your microphone. Please check your permissions.");
                isRecording = false;
                micButton.classList.remove('recording');
            });
    }
    
    // Stop recording audio
    function stopRecording() {
        if (mediaRecorder && isRecording) {
            mediaRecorder.stop();
            isRecording = false;
            micButton.classList.remove('recording');
            
            // Stop all tracks to release the microphone
            mediaRecorder.stream.getTracks().forEach(track => track.stop());
        }
    }
    
    // Process the recorded audio
    async function processAudio(audioBlob) {
        // Add a placeholder for the user's voice input
        const voiceMessageElement = addMessage("🎤 (Voice message)", true);
        
        // Show typing indicator after the voice message placeholder
        showTypingIndicator(chatbotMessages);
        
        try {
            // Simuler un délai pour tester l'indicateur (à supprimer en production)
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const formData = new FormData();
            formData.append('audio', audioBlob);
            formData.append('language', currentLanguage);
            
            const response = await fetch('/speech_to_text', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok && data.text) {
                // Update the placeholder with actual transcribed text
                voiceMessageElement.textContent = data.text;
                
                // Process the recognized text
                try {
                    // Call the backend API for response
                    const generateResponse = await fetch('/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ query: data.text }),
                    });
                    
                    const responseData = await generateResponse.json();
                    
                    // Hide typing indicator and add bot response
                    hideTypingIndicator();
                    
                    if (generateResponse.ok) {
                        addMessage(responseData.answer);
                        
                        // Generate speech for voice mode
                        generateSpeech(responseData.answer);
                    } else {
                        throw new Error(responseData.error || 'Failed to get response');
                    }
                } catch (error) {
                    hideTypingIndicator();
                    addMessage("I'm sorry, I'm having trouble processing your question. Please try again later.");
                }
            } else {
                hideTypingIndicator();
                voiceMessageElement.textContent = "🎤 (Could not transcribe voice)";
                addMessage("I couldn't understand that. Could you try speaking again?");
            }
        } catch (error) {
            console.error("Error processing audio:", error);
            hideTypingIndicator();
            addMessage("I had trouble processing your voice. Please try again.");
        }
    }
    
    // Send message when button is clicked
    sendButton.addEventListener('click', () => {
        const message = userInput.value.trim();
        if (message) {
            processMessage(message);
            userInput.value = '';
        }
    });
    
    // Send message when Enter key is pressed
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const message = userInput.value.trim();
            if (message) {
                processMessage(message);
                userInput.value = '';
            }
        }
    });
    
    // Auto-pulse the chatbot button after a delay
    setTimeout(() => {
        if (!chatbotWindow.classList.contains('active')) {
            chatbotButton.classList.add('pulse');
        }
    }, 5000);
    
    // Listen for language changes if language switcher is present
    try {
        const languageSwitcher = document.querySelector('.language-switcher');
        if (languageSwitcher) {
            languageSwitcher.addEventListener('change', function() {
                currentLanguage = this.value;
                console.log(`Chatbot language set to: ${currentLanguage}`);
            });
        }
    } catch (error) {
        console.log('Language switcher not found');
    }
});
    </script>
</body>
</html>